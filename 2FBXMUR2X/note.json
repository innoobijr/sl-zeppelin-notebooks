{
  "paragraphs": [
    {
      "text": "%spark.pyspark\r\n\r\nimport os\r\nfrom datetime import datetime\r\nimport matplotlib.pyplot as plt\r\nfrom pyspark.sql import SQLContext\r\n\r\nfrom pyspark.sql.types import StructType, StructField, StringType, IntegerType\r\nfrom pyspark.sql.functions import split, lower\r\nimport pyspark.sql.functions as F",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:13:21.333",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594090475029_-284604824",
      "id": "20200707-025435_458548033",
      "dateCreated": "2020-07-07 02:54:35.029",
      "dateStarted": "2020-07-07 03:13:21.339",
      "dateFinished": "2020-07-07 03:13:21.346",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n\nACCESS_KEY \u003d os.environ[\u0027AWS_ID\u0027]\nSECRET_KEY \u003d os.environ[\u0027AWS_SECRET\u0027]\n\nsc._jsc.hadoopConfiguration().set(\"fs.s3n.awsAccessKeyId\", ACCESS_KEY)\nsc._jsc.hadoopConfiguration().set(\"fs.s3n.awsSecretAccessKey\", SECRET_KEY)\n\nsq \u003d SQLContext(sc)",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:13:23.461",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594090504556_-543082466",
      "id": "20200707-025504_1479551371",
      "dateCreated": "2020-07-07 02:55:04.557",
      "dateStarted": "2020-07-07 03:13:23.466",
      "dateFinished": "2020-07-07 03:13:23.473",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nnames\u003d{\u0027antenna_id\u0027: StringType(),\u0027time\u0027: StringType(),\u0027cdr_type\u0027: StringType(),\u0027source\u0027: StringType(),\u0027target\u0027: StringType(),\u0027duration\u0027: IntegerType()}\nfields\u003d[]\nfor header in names:\n    fields.append(StructField(header, names[header], False))\nschema \u003d StructType(fields)\n# df \u003d sq.read.csv(\u0027./data/20200321_20.csv\u0027, schema\u003dschema)\ndf \u003d sq.read.csv(\u0027s3n://sierra-leone-lake/blob/cdrs/africell-raw/2020042[1-3]_01.csv\u0027, schema\u003dschema)\n\ndf \u003d df.withColumn(\u0027direction\u0027, lower(split(df[\u0027cdr_type\u0027], \u0027 \u0027).getItem(0)))\\\n        .withColumn(\u0027subscriber\u0027, F.when(F.col(\u0027direction\u0027)\u003d\u003d\u0027incoming\u0027, df.target).otherwise(df.source))\\\n        .withColumn(\"call_datetime\", F.to_timestamp(\"time\"))\\\n        .withColumn(\"call_date\", F.to_date(\"call_datetime\"))\ndf \u003d df.drop(\u0027time\u0027, \u0027cdr_type\u0027, \u0027source\u0027, \u0027target\u0027, \u0027direction\u0027)",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:25:52.245",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594090526582_-2099422552",
      "id": "20200707-025526_193546216",
      "dateCreated": "2020-07-07 02:55:26.582",
      "dateStarted": "2020-07-07 03:19:35.462",
      "dateFinished": "2020-07-07 03:19:37.967",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\ndf.show()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:19:47.333",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+----------+--------+--------------------+-------------------+----------+\n|antenna_id|duration|          subscriber|      call_datetime| call_date|\n+----------+--------+--------------------+-------------------+----------+\n|     34909|       0|6FF692AD134D90D34...|2020-04-22 01:00:17|2020-04-22|\n|     14112|       0|107F8B8C9DCDFBF82...|2020-04-22 01:00:17|2020-04-22|\n|     40115|       0|6FF692AD134D90D34...|2020-04-22 01:00:18|2020-04-22|\n|     22312|       4|FD9D57181BD0A7C31...|2020-04-22 01:00:13|2020-04-22|\n|     12012|       3|4AFF81B020BEEB9CC...|2020-04-22 01:00:15|2020-04-22|\n|     14234|      10|2467294507C524DD6...|2020-04-22 01:00:07|2020-04-22|\n|     34759|      10|2467294507C524DD6...|2020-04-22 01:00:07|2020-04-22|\n|     14263|       0|6FF692AD134D90D34...|2020-04-22 01:00:17|2020-04-22|\n|     21183|       4|ED179A3FCE9E6C611...|2020-04-22 01:00:14|2020-04-22|\n|     40990|       0|A685F353D568E7622...|2020-04-22 01:00:16|2020-04-22|\n|     34222|       4|BE839DAB3249532C0...|2020-04-22 01:00:13|2020-04-22|\n|     10254|       4|BE839DAB3249532C0...|2020-04-22 01:00:13|2020-04-22|\n|     14396|       0|107F8B8C9DCDFBF82...|2020-04-22 01:00:18|2020-04-22|\n|     10202|       4|1E1179734F19E131A...|2020-04-22 01:00:14|2020-04-22|\n|     20393|       0|14BDD5E7024AA7BA8...|2020-04-22 01:00:18|2020-04-22|\n|     12041|       0|AB3CC3961E3262A28...|2020-04-22 01:00:19|2020-04-22|\n|     12222|       0|6FF692AD134D90D34...|2020-04-22 01:00:18|2020-04-22|\n|     34705|       0|4B9B9B0FFBF30D71C...|2020-04-22 01:00:18|2020-04-22|\n|     34705|       0|4B9B9B0FFBF30D71C...|2020-04-22 01:00:19|2020-04-22|\n|     20153|       4|D99B3D1BBE1302C41...|2020-04-22 01:00:15|2020-04-22|\n+----------+--------+--------------------+-------------------+----------+\nonly showing top 20 rows\n\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594091864861_-325281725",
      "id": "20200707-031744_571711245",
      "dateCreated": "2020-07-07 03:17:44.861",
      "dateStarted": "2020-07-07 03:19:47.339",
      "dateFinished": "2020-07-07 03:19:48.794",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nper_towers \u003d df.groupBy(\u0027subscriber\u0027, \u0027antenna_id\u0027).count()\\\n        .groupBy(\u0027antenna_id\u0027).agg(F.sum(\u0027count\u0027).alias(\u0027total_records\u0027), F.avg(\u0027count\u0027).alias(\u0027per_subscriber\u0027))",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:24:19.170",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594091317306_2054994520",
      "id": "20200707-030837_1766143033",
      "dateCreated": "2020-07-07 03:08:37.306",
      "dateStarted": "2020-07-07 03:24:19.178",
      "dateFinished": "2020-07-07 03:24:19.216",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nper_towers.show()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:24:31.850",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+----------+-------------+------------------+\n|antenna_id|total_records|    per_subscriber|\n+----------+-------------+------------------+\n|     35374|         1987| 55.19444444444444|\n|     22254|            5|1.6666666666666667|\n|     22596|            8|               1.6|\n|     34635|           57|2.4782608695652173|\n|     35444|           19|2.7142857142857144|\n|     35670|           21|               2.1|\n|     20512|           66|2.5384615384615383|\n|     35640|           47|3.1333333333333333|\n|     40340|           33|              2.75|\n|     35350|           18|2.5714285714285716|\n|     36526|           22|3.6666666666666665|\n|     40874|           12|               2.4|\n|     34657|           11|              2.75|\n|     34829|           48| 2.823529411764706|\n|     40512|           22| 3.142857142857143|\n|     34404|            6|               2.0|\n|     14218|           83|2.3714285714285714|\n|     35089|            8|               1.6|\n|     35771|            9|              2.25|\n|     20141|           81|           2.53125|\n+----------+-------------+------------------+\nonly showing top 20 rows\n\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594092259170_181786192",
      "id": "20200707-032419_1143685178",
      "dateCreated": "2020-07-07 03:24:19.170",
      "dateStarted": "2020-07-07 03:24:31.862",
      "dateFinished": "2020-07-07 03:24:35.180",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nper_towers.count()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:42:17.525",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "3763\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594093326601_-338058234",
      "id": "20200707-034206_382857889",
      "dateCreated": "2020-07-07 03:42:06.601",
      "dateStarted": "2020-07-07 03:42:17.535",
      "dateFinished": "2020-07-07 03:42:22.276",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\ntowers \u003d sq.read.csv(\"s3n://sierra-leone-lake/blob/TOWERS/africell/sites_2020-07*.csv\", header\u003d\"true\")",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 04:07:43.511",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594092271850_-657875817",
      "id": "20200707-032431_1042492022",
      "dateCreated": "2020-07-07 03:24:31.850",
      "dateStarted": "2020-07-07 04:07:43.521",
      "dateFinished": "2020-07-07 04:07:45.408",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\ntowers_list \u003d towers.select(\u0027CI\u0027).rdd.flatMap(lambda x: x).collect()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 04:08:49.848",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594092417699_-844652714",
      "id": "20200707-032657_1803730694",
      "dateCreated": "2020-07-07 03:26:57.699",
      "dateStarted": "2020-07-07 04:08:49.859",
      "dateFinished": "2020-07-07 04:08:50.607",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\ntowers.show()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:43:54.347",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+-------+-----+----------------+----------------+--------+----------+----------+----------------+----------------+--------------+\n|site_id|   CI|         BTSNAME|            Name|Latitude| longitude|  location|        New_Dist|      New_Dist_1|     New_Chief|\n+-------+-----+----------------+----------------+--------+----------+----------+----------------+----------------+--------------+\n|   1000|10008|  MOUNTAUREOL_II|  MOUNTAUREOL_II|8.480993|-13.218795|FT CENTRAL|Western Area Urb|Western Area Urb|       East II|\n|   1001|10018|       CONGOTOWN|       CONGOTOWN|8.483741|-13.256992|   FT WEST|Western Area Urb|Western Area Urb|       West II|\n|   1002|10028|SPURROADMILITARY|SPURROADMILITARY| 8.47093| -13.27157|   FT WEST|Western Area Urb|Western Area Urb|      West III|\n|   1003|10039|       DEVILHOLE|       DEVILHOLE| 8.36205|  -13.0783|   FT EAST|Western Area Rur|Western Area Rur|Waterloo Rural|\n|   1004|10047|      KISSYHOUSE|      KISSYHOUSE| 8.48401|  -13.2384|FT CENTRAL|Western Area Urb|Western Area Urb|    Central II|\n|   1005|10058|         SLCB_II|         SLCB_II| 8.48795|  -13.2352|FT CENTRAL|Western Area Urb|Western Area Urb|    Central II|\n|   1006|10069|      ROCKELBANK|      ROCKELBANK| 8.48867|  -13.2315|FT CENTRAL|Western Area Urb|Western Area Urb|     Central I|\n|   1007|10078|       KISSYROAD|       KISSYROAD| 8.48721|  -13.2225|FT CENTRAL|Western Area Urb|Western Area Urb|        East I|\n|   1008|10088|       CLINETOWN|       CLINETOWN|8.491377|-13.209388|FT CENTRAL|Western Area Urb|Western Area Urb|        East I|\n|   1009|10092|       BARMHOTEL|       BARMHOTEL| 8.49561| -13.29665|   FT WEST|Western Area Urb|Western Area Urb|      West III|\n|   1010|10106|       BINTUMANI|       BINTUMANI| 8.49647| -13.28725|   FT WEST|Western Area Urb|Western Area Urb|      West III|\n|   1011|10118|          MAHERA|          MAHERA|8.605081|-13.198528| Air Port-|       Port Loko|       Port Loko|  Kaffu Bullom|\n|   1012|10128|          TAGRIN|          TAGRIN|8.522981|-13.148938| Air Port-|       Port Loko|       Port Loko|  Kaffu Bullom|\n|   1013|10138|    LUNGIAIRPORT|    LUNGIAIRPORT|8.615386|-13.202306| Air Port-|       Port Loko|       Port Loko|  Kaffu Bullom|\n|   1014|10148|     HAGANSTREET|     HAGANSTREET| 8.48832| -13.22643|FT CENTRAL|Western Area Urb|Western Area Urb|       East II|\n|   1015|10159|   KENNEDYSTREET|   KENNEDYSTREET| 8.48441| -13.21461|FT CENTRAL|Western Area Urb|Western Area Urb|        East I|\n|   1016|10166|   MOUNTAINCOURT|   MOUNTAINCOURT| 8.48111| -13.22819|FT CENTRAL|Western Area Urb|Western Area Urb|     Central I|\n|   1017|10182|   GODRECHSTREET|         ADONKIA|8.413635|-13.264048|FT CENTRAL|Western Area Rur|Western Area Rur|    York Rural|\n|   1018|10201|      KINGHARMAN|   GODRECHSTREET| 8.48674|  -13.2289|   FT WEST|Western Area Urb|Western Area Urb|     Central I|\n|   1019|10202|      KINGHARMAN|    BATHURSTREET| 8.48599|  -13.2375|   FT WEST|Western Area Urb|Western Area Urb|    Central II|\n+-------+-----+----------------+----------------+--------+----------+----------+----------------+----------------+--------------+\nonly showing top 20 rows\n\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594092423809_-1140391597",
      "id": "20200707-032703_1916027880",
      "dateCreated": "2020-07-07 03:27:03.809",
      "dateStarted": "2020-07-07 03:43:54.363",
      "dateFinished": "2020-07-07 03:43:54.655",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nper_towers.filter(~F.col(\u0027antenna_id\u0027).isin(*towers_list)).count()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 04:09:28.920",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "3250\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594093395881_1401748239",
      "id": "20200707-034315_93159",
      "dateCreated": "2020-07-07 03:43:15.881",
      "dateStarted": "2020-07-07 04:09:28.933",
      "dateFinished": "2020-07-07 04:09:34.758",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 04:07:59.445",
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1594094879444_1027826665",
      "id": "20200707-040759_85523080",
      "dateCreated": "2020-07-07 04:07:59.444",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "MIT/towerQueries",
  "id": "2FBXMUR2X",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {
    "python:shared_process": [],
    "spark:shared_process": []
  },
  "config": {
    "isZeppelinNotebookCronEnable": false
  },
  "info": {}
}