{
  "paragraphs": [
    {
      "text": "%spark.pyspark\r\n\r\nimport pandas as pd\r\nimport numpy as np\r\nimport os\r\nfrom pyspark.sql import SQLContext\r\n\r\nfrom pyspark.sql.types import StructType, StructField, StringType, IntegerType\r\nfrom pyspark.sql.functions import split, lower\r\nimport pyspark.sql.functions as F",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:12:35.033",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1593916576083_1435496",
      "id": "20200705-023616_2123755354",
      "dateCreated": "2020-07-05 02:36:16.083",
      "dateStarted": "2020-07-07 02:05:34.945",
      "dateFinished": "2020-07-07 02:05:34.954",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n\nACCESS_KEY \u003d os.environ[\u0027AWS_ID\u0027]\nSECRET_KEY \u003d os.environ[\u0027AWS_SECRET\u0027]\n\nsc._jsc.hadoopConfiguration().set(\"fs.s3n.awsAccessKeyId\", ACCESS_KEY)\nsc._jsc.hadoopConfiguration().set(\"fs.s3n.awsSecretAccessKey\", SECRET_KEY)\n\nsq \u003d SQLContext(sc)",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 02:05:36.956",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1593916845185_651559205",
      "id": "20200705-024045_17314118",
      "dateCreated": "2020-07-05 02:40:45.185",
      "dateStarted": "2020-07-07 02:05:36.982",
      "dateFinished": "2020-07-07 02:05:36.992",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nnames\u003d{\u0027antenna_id\u0027: StringType(),\u0027time\u0027: StringType(),\u0027cdr_type\u0027: StringType(),\u0027source\u0027: StringType(),\u0027target\u0027: StringType(),\u0027duration\u0027: IntegerType()}\nfields\u003d[]\nfor header in names:\n    fields.append(StructField(header, names[header], False))\nschema \u003d StructType(fields)\n# df \u003d sq.read.csv(\u0027./data/20200321_20.csv\u0027, schema\u003dschema)\ndf \u003d sq.read.csv(\u0027s3n://sierra-leone-lake/blob/cdrs/africell-raw/2020042[1-3]_01.csv\u0027, schema\u003dschema)\\\n        .withColumn(\u0027direction\u0027, lower(split(df[\u0027cdr_type\u0027], \u0027 \u0027).getItem(0)))\\\n        .withColumn(\u0027subscriber\u0027, F.when(df[\u0027direction\u0027] \u003d\u003d\u0027incoming\u0027, df.target).otherwise(df.source))\\\n        .withColumn(\"call_datetime\", F.to_timestamp(\"time\"))\\\n        .withColumn(\"call_date\", F.to_date(\"call_datetime\"))\\\n        .drop(\u0027time\u0027, \u0027cdr_type\u0027, \u0027source\u0027, \u0027target\u0027, \u0027direction\u0027)",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 20:52:52.926",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1593916905664_-1634322537",
      "id": "20200705-024145_2004383312",
      "dateCreated": "2020-07-05 02:41:45.664",
      "dateStarted": "2020-07-07 02:40:57.659",
      "dateFinished": "2020-07-07 02:40:59.658",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nnum_count \u003d df.agg(F.countDistinct(\u0027subscriber\u0027).alias(\u0027users\u0027), F.countDistinct(\u0027antenna_id\u0027).alias(\u0027towers\u0027))",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 02:52:42.482",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594070895271_-1010147034",
      "id": "20200706-212815_698741103",
      "dateCreated": "2020-07-06 21:28:15.271",
      "dateStarted": "2020-07-07 02:41:06.750",
      "dateFinished": "2020-07-07 02:41:06.825",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\nnum_count.show()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 02:42:26.713",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+-----+------+\n|users|towers|\n+-----+------+\n|25229|  3763|\n+-----+------+\n\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594070904130_-416533341",
      "id": "20200706-212824_453804982",
      "dateCreated": "2020-07-06 21:28:24.130",
      "dateStarted": "2020-07-07 02:42:26.765",
      "dateFinished": "2020-07-07 02:42:30.006",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n\nusers \u003d df.groupBy(\u0027subscriber\u0027, \u0027call_date\u0027).count()\\\n        .groupBy(\u0027call_date\u0027).agg(F.count(\u0027count\u0027).alias(\u0027subscribers\u0027), F.avg(\u0027count\u0027).alias(\u0027call_per_subscriber\u0027))\n# avg_per_day.createOrReplaceTempView(\"avg_per_day\")",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 02:53:44.356",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1594090362553_513859717",
      "id": "20200707-025242_1313244836",
      "dateCreated": "2020-07-07 02:52:42.553",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\navg_per_day.show()",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 02:42:52.546",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/python"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "+----------+-----------+-------------------+\n| call_date|subscribers|call_per_subscriber|\n+----------+-----------+-------------------+\n|2020-04-21|       7642| 5.0535200209369275|\n|2020-04-23|       8887|  4.689434004726004|\n|2020-04-22|       9722|  4.890146060481382|\n+----------+-----------+-------------------+\n\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1594070914930_-1827843318",
      "id": "20200706-212834_1339176152",
      "dateCreated": "2020-07-06 21:28:34.930",
      "dateStarted": "2020-07-07 02:42:52.558",
      "dateFinished": "2020-07-07 02:42:55.140",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "",
      "user": "anonymous",
      "dateUpdated": "2020-07-07 03:11:48.107",
      "config": {
        "colWidth": 12.0,
        "fontSize": 9.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": []
      },
      "apps": [],
      "jobName": "paragraph_1594070925959_157477587",
      "id": "20200706-212845_1398092782",
      "dateCreated": "2020-07-06 21:28:45.959",
      "dateStarted": "2020-07-07 02:42:19.219",
      "dateFinished": "2020-07-07 02:42:24.892",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark.pyspark\n",
      "user": "anonymous",
      "dateUpdated": "2020-07-06 21:30:39.882",
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1594071039882_451188179",
      "id": "20200706-213039_1895791629",
      "dateCreated": "2020-07-06 21:30:39.882",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "MIT/generalQueries",
  "id": "2FD2AF51Q",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {
    "python:shared_process": [],
    "spark:shared_process": []
  },
  "config": {
    "isZeppelinNotebookCronEnable": false
  },
  "info": {}
}